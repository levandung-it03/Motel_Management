CREATE DATABASE Motel_Management
CREATE TABLE Region (
    regionId VARCHAR(20) UNIQUE NOT NULL,
    region VARCHAR(20) UNIQUE NOT NULL,
    CONSTRAINT PK_Region PRIMARY KEY (regionId)
);
CREATE TABLE Account (
    userId VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(20) NOT NULL,
    username VARCHAR(10) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    CONSTRAINT PK_Account PRIMARY KEY (userId)
);
CREATE TABLE Room (
    roomId VARCHAR(20) UNIQUE NOT NULL,
    quantity INT DEFAULT 0 CHECK (quantity <= maxQuantity),
    maxQuantity INT DEFAULT 0,
    CONSTRAINT PK_Room PRIMARY KEY (RoomId)
);
CREATE TABLE ElectricRange(
    rangeId VARCHAR(20) UNIQUE NOT NULL,
    rangeName VARCHAR(20) UNIQUE NOT NULL,
    minRangeValue INT DEFAULT 0,
    maxRangeValue INT DEFAULT 0,
    price INT DEFAULT 0,
    CONSTRAINT PK_ElectricRange PRIMARY KEY (rangeId)
);
CREATE TABLE WaterRange(
    rangeId VARCHAR(20) UNIQUE NOT NULL,
    rangeName VARCHAR(20) UNIQUE NOT NULL,
    minRangeValue INT DEFAULT 0,
    maxRangeValue INT DEFAULT 0,
    price INT DEFAULT 0,
    CONSTRAINT PK_WaterRange PRIMARY KEY (rangeId)
);

CREATE TABLE Person (
    identifier VARCHAR(20) UNIQUE NOT NULL,
    roomId VARCHAR(20) NOT NULL,
    lastName VARCHAR(70) NOT NULL,
    firstName VARCHAR(30) NOT NULL,
    birthday DATE NOT NULL,
    phone VARCHAR(15) NOT NULL,
    gender VARCHAR(1) NOT NULL,
    jobTitle VARCHAR(70) NOT NULL,
    permanentAddress VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    bankAccountNumber VARCHAR(255),
    bank VARCHAR(255),
    isOccupied BOOLEAN DEFAULT FALSE,

    CONSTRAINT PK_Person PRIMARY KEY (identifier),
    CONSTRAINT FK_Person_roomId FOREIGN KEY (roomId) REFERENCES Room(roomId),
    CONSTRAINT UK_Person UNIQUE (identifier, roomId)
);

CREATE TABLE Contract (
    contractId VARCHAR(20) UNIQUE NOT NULL,
    identifier VARCHAR(20) NOT NULL,
    quantity INT DEFAULT 0,
    roomDeposit INT DEFAULT 0,
    isFamily BOOLEAN DEFAULT FALSE,
    startingDate DATE DEFAULT (CURRENT_DATE()),
    endingDate DATE DEFAULT (CURRENT_DATE()),
    isRegisteredPerAddress BOOLEAN DEFAULT FALSE,
    checkedOut BOOLEAN DEFAULT FALSE,

    CONSTRAINT PK_Contract PRIMARY KEY (contractId),
    CONSTRAINT FK_Contract_identifier FOREIGN KEY (identifier) REFERENCES Person(identifier),
    CONSTRAINT UK_Contract UNIQUE (contractId, identifier)
);

CREATE TABLE CheckOut(
    checkOutId VARCHAR(20) UNIQUE NOT NULL,
    contractId VARCHAR(20) NOT NULL,
    checkOutDate DATE DEFAULT (CURRENT_DATE()),
    reason VARCHAR(255),

    CONSTRAINT PK_CheckOut PRIMARY KEY (checkOutId),
    CONSTRAINT FK_CheckOut_contractId FOREIGN KEY (contractId) REFERENCES Contract(contractId)
);

CREATE TABLE RoomPriceHistory(
    roomId VARCHAR(20) NOT NULL,
    priceRaisedDate DATE NOT NULL DEFAULT CURRENT_DATE,
    roomPrice INT DEFAULT 0,

    CONSTRAINT FK_RaisingRoomPrice_roomId FOREIGN KEY (roomId) REFERENCES Room(roomId),
    CONSTRAINT PK_RaisingRoomPrice PRIMARY KEY (roomId, priceRaisedDate)
);

CREATE TABLE Invoice(
    invoiceId VARCHAR(20) UNIQUE NOT NULL,
    roomId VARCHAR(20) NOT NULL,
    priceRaisedDate DATE NOT NULL,
    dateCreated DATE DEFAULT CURRENT_DATE,
    paymentYear INT NOT NULL,
    paymentMonth INT NOT NULL,
    formerElectricNumber INT DEFAULT 0,
    newElectricNumber INT DEFAULT 0,
    formerWaterNumber INT DEFAULT 0,
    newWaterNumber INT DEFAULT 0,
    electricPrice INT DEFAULT 0,
    waterPrice INT DEFAULT 0,
    garbage INT DEFAULT 0,
    wifi INT DEFAULT 0,
    vehicle INT DEFAULT 0,
    wasPaid BOOLEAN DEFAULT FALSE,

    CONSTRAINT PK_Invoice PRIMARY KEY (invoiceId),
    CONSTRAINT FK_Invoice_roomId FOREIGN KEY (roomId) REFERENCES Room(roomId),
    CONSTRAINT FK_RoomPriceHistory_priceRaisedDate FOREIGN KEY (roomId, priceRaisedDate) REFERENCES RoomPriceHistory(roomId, priceRaisedDate),
    CONSTRAINT UK_Invoice UNIQUE (roomId, paymentMonth, paymentYear)
);

INSERT INTO Account VALUES ("admin000", "Root", "root", "$2a$10$j2WJzi7wT1BazuUsnKa8vOmbanLacmKc042wJLWWUxMK5eM3zPXjS");
// MK: root#123
INSERT INTO Room VALUES ("P001", 0, 9, 3000000), ("P002", 0, 9, 3000000), ("P003", 0, 9, 3000000), ("P004", 0, 9, 3000000), ("P005", 0, 9, 3000000),
("P006", 0, 9, 3000000);

INSERT INTO Room
VALUES
("P001", 0, 9, 3000000),
("P002", 0, 9, 3000000),
("P003", 0, 9, 3000000),
("P004", 0, 9, 3000000),
("P005", 0, 9, 3000000),
("P006", 0, 9, 3000000),
("P007", 0, 9, 3000000);

INSERT INTO Person (identifier, roomId, lastName, firstName, birthday, phone, gender, jobTitle, permanentAddress, email, bankAccountNumber, bank)
VALUES
('038203032574', 'P001', 'Le Van', 'Dung', '1990-01-15', '123456789', '0', 'Manager', '123 Main St', 'vana@example.com', '123-456-789', 'ACB'),
('038203032575', 'P002', 'Le Van', 'Duong', '1985-05-20', '987654321', '0', 'Engineer', '456 Oak St', 'thib@example.com', '987-654-321', 'Vietcombank'),
('038203032576', 'P002', 'Le Van', 'Hung', '1985-05-20', '987654321', '0', 'Engineer', '456 Oak St', 'thia@example.com', '987-654-321', 'Vietcombank'),
('038203032577', 'P002', 'Tran Thi', 'An', '1985-05-20', '987654321', '1', 'Engineer', '456 Oak St', 'thic@example.com', '987-654-321', 'Vietcombank'),
('038203032578', 'P003', 'Le Duc', 'Thai', '1995-08-10', '456123789', '0', 'Analyst', '789 Pine St', 'ducc@example.com', '456-123-789', 'Techcombank');

INSERT INTO Contract
VALUES
("C1000001", "038203032574", 5, 1000000, "0", "2024-01-19", "2024-03-19", "0", "0"),
("C1000002", "038203032575", 5, 1000000, "0", "2024-01-19", "2024-03-19", "0", "1"),
("C1000003", "038203032576", 5, 1000000, "0", "2024-05-19", "2024-08-19", "0", "1"),
("C1000004", "038203032577", 5, 1000000, "0", "2024-09-19", "2024-12-19", "0", "0"),
("C1000005", "038203032578", 5, 1000000, "0", "2024-09-29", "2024-11-19", "0", "0");