CREATE DATABASE Motel_Management
CREATE TABLE Region (
    regionId VARCHAR(20) UNIQUE NOT NULL,
    region VARCHAR(20) UNIQUE NOT NULL,
    CONSTRAINT PK_Region PRIMARY KEY (regionId)
);
CREATE TABLE Account (
    userId VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(20) NOT NULL,
	username VARCHAR(10) UNIQUE NOT NULL,
	password VARCHAR(20) NOT NULL,
    CONSTRAINT PK_Account PRIMARY KEY (userId)
);
CREATE TABLE Room (
    roomId VARCHAR(20) UNIQUE NOT NULL,
    quantity INT DEFAULT 0 CHECK (quantity <= maxQuantity),
    maxQuantity INT DEFAULT 0,
    defaultRoomPrice INT DEFAULT 0,
    CONSTRAINT PK_Room PRIMARY KEY (RoomId)
);
CREATE TABLE ElectricRange(
    rangeId VARCHAR(20) UNIQUE NOT NULL,
    rangeName VARCHAR(20) UNIQUE NOT NULL,
    minRangeValue INT DEFAULT 0,
    maxRangeValue INT DEFAULT 0,
    price INT DEFAULT 0,
    CONSTRAINT PK_ElectricRange PRIMARY KEY (rangeId)
);
CREATE TABLE WaterRange(
    rangeId VARCHAR(20) UNIQUE NOT NULL,
    rangeName VARCHAR(20) NOT NULL,
    minRangeValue INT DEFAULT 0,
    maxRangeValue INT DEFAULT 0,
    price INT DEFAULT 0,
    CONSTRAINT PK_WaterRange PRIMARY KEY (rangeId)
);

CREATE TABLE Person (
    identifier VARCHAR(20) UNIQUE NOT NULL,
    roomId VARCHAR(20) NOT NULL,
    lastName VARCHAR(70) NOT NULL,
    firstName VARCHAR(30) NOT NULL,
    birthday DATE NOT NULL,
    phone VARCHAR(15) NOT NULL,
    gender VARCHAR(1) NOT NULL,
    jobTitle VARCHAR(70) NOT NULL,
    permanentAddress VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    bankAccountNumber VARCHAR(255),
    bank VARCHAR(255),

    CONSTRAINT PK_Person PRIMARY KEY (identifier),
    CONSTRAINT FK_Person_roomId FOREIGN KEY (roomId) REFERENCES Room(roomId),
    CONSTRAINT UK_Person UNIQUE (identifier, roomId)
);

CREATE TABLE Contract (
    contractId VARCHAR(20) UNIQUE NOT NULL,
    identifier VARCHAR(20) NOT NULL,
    roomId VARCHAR(20) NOT NULL,
    quantity INT DEFAULT 0,
    roomDeposit INT DEFAULT 0,
    isFamily VARCHAR(1) DEFAULT "0",
    startingDate DATE DEFAULT (CURRENT_DATE()),
    endingDate DATE DEFAULT (CURRENT_DATE()),
    totalMonths INT DEFAULT 0,
    isRegisteredPerAddress VARCHAR(1) DEFAULT "0",
    checkedOut VARCHAR(1) DEFAULT "0",

    CONSTRAINT PK_Contract PRIMARY KEY (contractId),
    CONSTRAINT FK_Contract_identifier FOREIGN KEY (identifier) REFERENCES Person(identifier),
    CONSTRAINT FK_Contract_roomId FOREIGN KEY (roomId) REFERENCES Room(roomId),
    CONSTRAINT UK_Contract UNIQUE (contractId, identifier, roomId)
);

CREATE TABLE CheckOut(
    checkOutId VARCHAR(20) UNIQUE NOT NULL,
    contractId VARCHAR(20) NOT NULL,
    checkOutDate DATE DEFAULT (CURRENT_DATE()),
    reason VARCHAR(255),

    CONSTRAINT PK_CheckOut PRIMARY KEY (checkOutId),
    CONSTRAINT FK_CheckOut_contractId FOREIGN KEY (contractId) REFERENCES Contract(contractId)
);

CREATE TABLE Invoice(
    invoiceId VARCHAR(20) UNIQUE NOT NULL,
    roomId VARCHAR(20) NOT NULL,
    defaultRoomPrice INT DEFAULT 0,
    dateCreated DATE DEFAULT CURRENT_DATE,
    paymentYear VARCHAR(4) NOT NULL,
    paymentMonth VARCHAR(2) NOT NULL,
    formerElectricNumber INT DEFAULT 0,
    newElectricNumber INT DEFAULT 0,
    formerWaterNumber INT DEFAULT 0,
    newWaterNumber INT DEFAULT 0,
    garbage INT DEFAULT 0,
    wifi INT DEFAULT 0,
    vehicle	INT DEFAULT 0,
    total INT DEFAULT 0,
    wasPaid VARCHAR(1) DEFAULT "0",

    CONSTRAINT PK_Invoice PRIMARY KEY (invoiceId),
    CONSTRAINT FK_Invoice_roomId FOREIGN KEY (roomId) REFERENCES Room(roomId),
    CONSTRAINT UK_Invoice UNIQUE (roomId, paymentMonth, paymentYear)
);

INSERT INTO Account VALUES ("admin000", "Root", "root", "123456"), ("admin001", "Dung", "levandung", "123456");
INSERT INTO Room VALUES ("P001", 0, 9, 3000000), ("P002", 0, 9, 3000000), ("P003", 0, 9, 3000000), ("P004", 0, 9, 3000000), ("P005", 0, 9, 3000000),
("P006", 0, 9, 3000000);
INSERT INTO ElectricRange VALUES ();
INSERT INTO WaterRange VALUES ();